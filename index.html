<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Crims Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }

        .tab-button.active {
            border-color: #f59e0b;
            background-color: #f59e0b;
            color: white;
        }

        .feedback-container {
            transition: max-height 0.4s ease-in-out, opacity 0.4s ease-in-out, margin-top 0.4s ease-in-out;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            margin-top: 0;
        }

            .feedback-container.active {
                max-height: 5rem; /* Altura máxima suficiente para o conteúdo */
                opacity: 1;
                margin-top: 1rem; /* Margem que aparece junto com a mensagem */
            }
    </style>
</head>
<body class="bg-gray-900 text-slate-300 flex items-center justify-center min-h-screen p-4 transition-colors duration-300">

    <div class="container bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl max-w-2xl w-full mx-auto space-y-6">
        <header class="text-center relative">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-amber-400" data-i18n-key="title"></h1>
            <p class="text-slate-400 mt-1" data-i18n-key="subtitle"></p>
        </header>

        <nav class="flex border-b border-gray-700">
            <button class="tab-button flex-1 py-3 px-4 text-sm sm:text-base font-semibold text-slate-400 border-b-2 border-transparent" data-tab-id="timeCalculatorTabContent" data-i18n-key="timeCalcTab"></button>
            <button class="tab-button flex-1 py-3 px-4 text-sm sm:text-base font-semibold text-slate-400 border-b-2 border-transparent" data-tab-id="pointsCalculatorTabContent" data-i18n-key="pointsCalcTab"></button>
        </nav>

        <main>
            <div id="timeCalculatorTabContent" class="tab-content space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label for="roundStartDate" class="font-semibold text-slate-200" data-i18n-key="roundStartLabel"></label>
                        <input type="datetime-local" id="roundStartDate" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-slate-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                    </div>
                    <div class="space-y-2">
                        <label for="currentRoundEndDate" class="font-semibold text-slate-200" data-i18n-key="roundEndLabel"></label>
                        <input type="datetime-local" id="currentRoundEndDate" readonly class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-slate-400 cursor-not-allowed">
                    </div>
                </section>
                <section>
                    <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="currentGameTime"></h3>
                    <div class="grid grid-cols-3 gap-3 text-center bg-gray-900/50 p-4 rounded-lg">
                        <div>
                            <span class="text-xs text-slate-400" data-i18n-key="day"></span>
                            <input type="number" id="currentDay" readonly class="w-full bg-transparent text-amber-400 text-2xl font-bold text-center outline-none">
                        </div>
                        <div>
                            <span class="text-xs text-slate-400" data-i18n-key="hour"></span>
                            <input type="number" id="currentHour" readonly class="w-full bg-transparent text-amber-400 text-2xl font-bold text-center outline-none">
                        </div>
                        <div>
                            <span class="text-xs text-slate-400" data-i18n-key="minute"></span>
                            <input type="number" id="currentMinute" readonly class="w-full bg-transparent text-amber-400 text-2xl font-bold text-center outline-none">
                        </div>
                    </div>
                </section>
                <section>
                    <h3 class="font-bold text-lg text-slate-200 mb-2" data-i18n-key="desiredGameTime"></h3>
                    <div class="grid grid-cols-3 gap-3 text-center">
                        <div>
                            <span class="text-xs text-slate-400" data-i18n-key="day"></span>
                            <select id="targetDay" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-center focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none mt-1"></select>
                        </div>
                        <div>
                            <span class="text-xs text-slate-400" data-i18n-key="hour"></span>
                            <select id="targetHour" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-center focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none mt-1"></select>
                        </div>
                        <div>
                            <span class="text-xs text-slate-400" data-i18n-key="minute"></span>
                            <select id="targetMinute" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-center focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none mt-1"></select>
                        </div>
                    </div>
                </section>
                <div class="flex flex-col sm:flex-row gap-3 pt-4">
                    <button id="calculateTimeButton" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg" data-i18n-key="calculate"></button>
                    <button id="resetTimeCalculatorButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg" data-i18n-key="reset"></button>
                </div>
                <div id="result" class="feedback-container text-center font-semibold text-green-400"></div>
                <div id="localTimeResult" class="feedback-container text-center text-sm text-slate-400"></div>
                <div id="errorMessage" class="feedback-container text-center font-semibold text-red-500"></div>
            </div>

            <div id="pointsCalculatorTabContent" class="tab-content hidden space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="space-y-2">
                        <label for="totalPoints" class="font-semibold text-slate-200" data-i18n-key="totalPointsLabel"></label>
                        <input type="number" id="totalPoints" min="0" value="10000" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-slate-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                    </div>
                    <div class="space-y-2">
                        <label for="playerClass" class="font-semibold text-slate-200" data-i18n-key="loadClassPreset"></label>
                        <select id="playerClass" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-slate-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                        </select>
                    </div>
                </section>

                <section id="pointsDistributionSection" class="bg-gray-900/50 p-4 rounded-lg space-y-3">
                </section>

                <div class="flex flex-col sm:flex-row gap-3 pt-4">
                    <button id="copyPointsButton" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-4 rounded-lg" data-i18n-key="copyBuild"></button>
                    <button id="resetPointsCalculatorButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg" data-i18n-key="resetPreset"></button>
                </div>
                <div id="pointsErrorMessage" class="feedback-container text-center font-semibold text-red-500"></div>
            </div>
        </main>

        <footer class="border-t border-gray-700 pt-4 text-center">
            <p class="text-sm text-slate-500" data-i18n-key="footerText"></p>
        </footer>
    </div>

    <script type="module">
        // --- CONFIGURAÇÕES GLOBAIS ---
        const CONFIG = {
            REAL_HOURS_PER_GAME_DAY: 6,
            GAME_MINUTES_PER_REAL_MINUTE: (24 / 6),
            DEFAULT_ROUND_START_DATE: new Date(2025, 6, 2, 12, 0),
            ROUND_DURATION_GAME_DAYS: 52,
            CLASS_IDS: ['assassino', 'cafetao', 'corretor', 'empresario', 'ladrao', 'traficante'],
            ATTRIBUTES_IDS: ['forca', 'tolerancia', 'inteligencia', 'carisma']
        };

        // --- TRADUÇÕES (i18n) ---
        const i18n = {
            en: {
                title: "The Crims Calculator",
                subtitle: "Tools to optimize your game.",
                timeCalcTab: "Time Calculator",
                pointsCalcTab: "Points Calculator",
                calculate: "Calculate",
                reset: "Reset",
                day: "Day",
                hour: "Hour",
                minute: "Minute",
                roundStartLabel: "Round Start (Real Time):",
                roundEndLabel: "Round End (Real Time):",
                currentGameTime: "Current Game Time",
                desiredGameTime: "Desired Game Time",
                realTimeNeeded: "Real time needed",
                localTimePrefix: "Predicted local time",
                errorInvalidStart: "Please enter a valid Round Start Date/Time in the past.",
                errorFillFields: "Please fill all 'Desired Time' fields.",
                errorFutureTime: "Desired time must be in the future.",
                timeIsSame: "Current and desired time are the same.",
                and: "and",
                hour_one: "hour",
                hour_other: "hours",
                minute_one: "minute",
                minute_other: "minutes",
                totalPointsLabel: "Total Points:",
                loadClassPreset: "Load Class Preset:",
                copyBuild: "Copy Build",
                resetPreset: "Reset Preset",
                copied: "Copied!",
                buildWith: "Build with",
                points: "points",
                totalPercent: "Total %",
                errorInvalidPoints: "Please enter a valid number of points.",
                errorPercentSum: "The sum of percentages must be 100%.",
                assassino: "Hitman",
                cafetao: "Pimp",
                corretor: "Broker",
                empresario: "Businessman",
                ladrao: "Robber",
                traficante: "Dealer",
                forca: "Strength",
                tolerancia: "Tolerance",
                inteligencia: "Intelligence",
                carisma: "Charisma",
                footerText: `Developed with 🧠 by <a href="https://github.com/bernardotraad" target="_blank" class="font-semibold text-amber-400 hover:underline">Bernardo Traad</a>`
            },
            pt: {
                title: "Calculadora The Crims",
                subtitle: "Ferramentas para otimizar seu jogo.",
                timeCalcTab: "Calculadora de Tempo",
                pointsCalcTab: "Calculadora de Pontos",
                calculate: "Calcular",
                reset: "Redefinir",
                day: "Dia",
                hour: "Hora",
                minute: "Minuto",
                roundStartLabel: "Início da Rodada (Real):",
                roundEndLabel: "Fim da Rodada (Real):",
                currentGameTime: "Tempo Atual no Jogo",
                desiredGameTime: "Tempo Desejado no Jogo",
                realTimeNeeded: "Tempo real necessário",
                localTimePrefix: "Hora local prevista",
                errorInvalidStart: "Por favor, insira uma Data/Hora de Início da Rodada válida e no passado.",
                errorFillFields: "Por favor, preencha todos os campos de 'Tempo Desejado'.",
                errorFutureTime: "O tempo desejado deve ser no futuro.",
                timeIsSame: "O tempo atual e o desejado são os mesmos.",
                and: "e",
                hour_one: "hora",
                hour_other: "horas",
                minute_one: "minuto",
                minute_other: "minutos",
                totalPointsLabel: "Total de Pontos:",
                loadClassPreset: "Carregar Padrão da Classe:",
                copyBuild: "Copiar Build",
                resetPreset: "Redefinir Padrão",
                copied: "Copiado!",
                buildWith: "Build com",
                points: "pontos",
                totalPercent: "Total %",
                errorInvalidPoints: "Por favor, insira um total de pontos válido.",
                errorPercentSum: "A soma das porcentagens deve ser 100%.",
                assassino: "Assassino de Aluguel",
                cafetao: "Cafetão",
                corretor: "Corretor",
                empresario: "Empresário",
                ladrao: "Ladrão",
                traficante: "Traficante",
                forca: "Força",
                tolerancia: "Tolerância",
                inteligencia: "Inteligência",
                carisma: "Carisma",
                footerText: `Desenvolvido com 🧠 por <a href="https://github.com/bernardotraad" target="_blank" class="font-semibold text-amber-400 hover:underline">Bernardo Traad</a>`
            }
        };

        const CLASS_DISTRIBUTIONS = {
            assassino: { forca: 0.50, tolerancia: 0.30, inteligencia: 0.15, carisma: 0.05 },
            cafetao: { carisma: 0.40, inteligencia: 0.25, tolerancia: 0.25, forca: 0.10 },
            corretor: { inteligencia: 0.45, carisma: 0.35, tolerancia: 0.15, forca: 0.05 },
            empresario: { inteligencia: 0.45, carisma: 0.35, tolerancia: 0.15, forca: 0.05 },
            ladrao: { inteligencia: 0.40, tolerancia: 0.35, forca: 0.20, carisma: 0.05 },
            traficante: { inteligencia: 0.38, tolerancia: 0.28, carisma: 0.28, forca: 0.06 }
        };

        const DOMElements = {
            tabs: document.querySelectorAll('.tab-button'),
            tabContents: document.querySelectorAll('.tab-content'),
            roundStartDate: document.getElementById('roundStartDate'),
            currentRoundEndDate: document.getElementById('currentRoundEndDate'),
            currentDay: document.getElementById('currentDay'),
            currentHour: document.getElementById('currentHour'),
            currentMinute: document.getElementById('currentMinute'),
            targetDay: document.getElementById('targetDay'),
            targetHour: document.getElementById('targetHour'),
            targetMinute: document.getElementById('targetMinute'),
            calculateTimeButton: document.getElementById('calculateTimeButton'),
            resetTimeCalculatorButton: document.getElementById('resetTimeCalculatorButton'),
            result: document.getElementById('result'),
            localTimeResult: document.getElementById('localTimeResult'),
            errorMessage: document.getElementById('errorMessage'),
            totalPoints: document.getElementById('totalPoints'),
            playerClass: document.getElementById('playerClass'),
            pointsDistributionSection: document.getElementById('pointsDistributionSection'),
            copyPointsButton: document.getElementById('copyPointsButton'),
            resetPointsCalculatorButton: document.getElementById('resetPointsCalculatorButton'),
            pointsErrorMessage: document.getElementById('pointsErrorMessage')
        };

        let currentLang = 'en';
        const getLang = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const forcedLang = urlParams.get('lang');
            if (forcedLang && i18n[forcedLang]) {
                return forcedLang;
            }
            const userLang = navigator.language || navigator.userLanguage;
            return userLang.startsWith('pt') ? 'pt' : 'en';
        };
        const t = (key) => i18n[currentLang]?.[key] || i18n['en'][key];

        function translatePage() {
            document.querySelectorAll('[data-i18n-key]').forEach(el => {
                const key = el.dataset.i18nKey;
                el.innerHTML = t(key);
            });
            DOMElements.playerClass.innerHTML = '';
            CONFIG.CLASS_IDS.forEach(id => {
                DOMElements.playerClass.add(new Option(t(id), id));
            });
        }

        const Utils = {
            formatDateForInput: (date) => {
                const pad = (num) => String(num).padStart(2, '0');
                return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
            },
            clearMessages: (...elements) => {
                elements.forEach(el => {
                    if (el) {
                        el.classList.remove('active');
                        setTimeout(() => { el.textContent = ''; }, 400);
                    }
                });
            },
            showMessage: (element, message) => {
                if (element) {
                    element.textContent = message;
                    element.classList.add('active');
                }
            },
            getInputValueAsInt: (element) => parseInt(element.value, 10),
            setInputValue: (element, value) => { element.value = value; }
        };

        function showTab(tabId) {
            DOMElements.tabContents.forEach(content => content.classList.add('hidden'));
            DOMElements.tabs.forEach(tab => tab.classList.remove('active'));
            document.getElementById(tabId).classList.remove('hidden');
            document.querySelector(`.tab-button[data-tab-id="${tabId}"]`).classList.add('active');
            Utils.clearMessages(DOMElements.errorMessage, DOMElements.result, DOMElements.localTimeResult, DOMElements.pointsErrorMessage);
        }

        const TimeCalculator = {
            populateDropdowns: () => {
                for (let i = 1; i <= 52; i++) { DOMElements.targetDay.add(new Option(i, i)); }
                for (let i = 0; i <= 23; i++) { DOMElements.targetHour.add(new Option(String(i).padStart(2, '0'), i)); }
                for (let i = 0; i <= 59; i++) { DOMElements.targetMinute.add(new Option(String(i).padStart(2, '0'), i)); }
            },
            calculateCurrentGameTime: () => {
                if (!DOMElements.roundStartDate.value) return false;
                const roundStart = new Date(DOMElements.roundStartDate.value);
                const now = new Date();
                const diffMs = now.getTime() - roundStart.getTime();
                if (diffMs < 0) {
                    [DOMElements.currentDay.value, DOMElements.currentHour.value, DOMElements.currentMinute.value] = [1, 0, 0];
                    return false;
                }
                const diffGameMinutes = (diffMs / 60000) * CONFIG.GAME_MINUTES_PER_REAL_MINUTE;
                const gameDays = Math.floor(diffGameMinutes / 1440);
                const remainingMinutes = diffGameMinutes % 1440;
                const gameHours = Math.floor(remainingMinutes / 60);
                const gameMinutes = Math.floor(remainingMinutes % 60);
                Utils.setInputValue(DOMElements.currentDay, gameDays + 1);
                Utils.setInputValue(DOMElements.currentHour, gameHours);
                Utils.setInputValue(DOMElements.currentMinute, gameMinutes);
                return true;
            },
            calculateCurrentRoundEndDate: () => {
                if (!DOMElements.roundStartDate.value) return;
                const roundStart = new Date(DOMElements.roundStartDate.value);
                const endDateMs = roundStart.getTime() + (CONFIG.ROUND_DURATION_GAME_DAYS * CONFIG.REAL_HOURS_PER_GAME_DAY * 3600000);
                Utils.setInputValue(DOMElements.currentRoundEndDate, Utils.formatDateForInput(new Date(endDateMs)));
            },
            calculateRealTime: () => {
                Utils.clearMessages(DOMElements.result, DOMElements.localTimeResult, DOMElements.errorMessage);
                if (!TimeCalculator.calculateCurrentGameTime()) {
                    Utils.showMessage(DOMElements.errorMessage, t('errorInvalidStart'));
                    return;
                }
                const [currentDay, currentHour, currentMinute] = [DOMElements.currentDay, DOMElements.currentHour, DOMElements.currentMinute].map(Utils.getInputValueAsInt);
                const [targetDay, targetHour, targetMinute] = [DOMElements.targetDay, DOMElements.targetHour, DOMElements.targetMinute].map(Utils.getInputValueAsInt);

                if ([targetDay, targetHour, targetMinute].some(isNaN)) {
                    Utils.showMessage(DOMElements.errorMessage, t('errorFillFields'));
                    return;
                }
                const currentTotalMinutes = (currentDay * 1440) + (currentHour * 60) + currentMinute;
                const targetTotalMinutes = (targetDay * 1440) + (targetHour * 60) + targetMinute;
                if (targetTotalMinutes < currentTotalMinutes) {
                    Utils.showMessage(DOMElements.errorMessage, t('errorFutureTime'));
                    return;
                }
                const diffGameMinutes = targetTotalMinutes - currentTotalMinutes;
                if (diffGameMinutes === 0) {
                    Utils.showMessage(DOMElements.result, t('timeIsSame'));
                    return;
                }
                const diffRealSeconds = diffGameMinutes * (60 / CONFIG.GAME_MINUTES_PER_REAL_MINUTE);
                const hours = Math.floor(diffRealSeconds / 3600);
                const minutes = Math.floor((diffRealSeconds % 3600) / 60);
                const pr = new Intl.PluralRules(currentLang);
                const hourKey = `hour_${pr.select(hours)}`;
                const minuteKey = `minute_${pr.select(minutes)}`;
                const resultParts = [];
                if (hours > 0) resultParts.push(`${hours} ${t(hourKey)}`);
                if (minutes > 0) resultParts.push(`${minutes} ${t(minuteKey)}`);
                Utils.showMessage(DOMElements.result, `${t('realTimeNeeded')}: ${resultParts.join(` ${t('and')} `)}`);
                const targetRealDate = new Date(new Date().getTime() + diffRealSeconds * 1000);
                Utils.showMessage(DOMElements.localTimeResult, `${t('localTimePrefix')}: ${targetRealDate.toLocaleString(currentLang, { dateStyle: 'long', timeStyle: 'short' })}`);
            },
            reset: () => {
                const savedStartDate = localStorage.getItem('roundStartDate');
                if (savedStartDate) {
                    DOMElements.roundStartDate.value = savedStartDate;
                } else {
                    Utils.setInputValue(DOMElements.roundStartDate, Utils.formatDateForInput(CONFIG.DEFAULT_ROUND_START_DATE));
                }
                TimeCalculator.calculateCurrentRoundEndDate();
                TimeCalculator.calculateCurrentGameTime();
                DOMElements.targetDay.value = localStorage.getItem('targetDay') || DOMElements.currentDay.value;
                DOMElements.targetHour.value = localStorage.getItem('targetHour') || DOMElements.currentHour.value;
                DOMElements.targetMinute.value = localStorage.getItem('targetMinute') || DOMElements.currentMinute.value;
                Utils.clearMessages(DOMElements.result, DOMElements.localTimeResult, DOMElements.errorMessage);
            }
        };

        const PointsCalculator = {
            init: () => {
                PointsCalculator.buildDistributionUI();
                PointsCalculator.loadPreset();
                DOMElements.playerClass.addEventListener('change', PointsCalculator.loadPreset);
                DOMElements.totalPoints.addEventListener('input', () => {
                    localStorage.setItem('totalPoints', DOMElements.totalPoints.value);
                    PointsCalculator.updateDistribution();
                });
                DOMElements.pointsDistributionSection.addEventListener('input', PointsCalculator.updateDistribution);
                DOMElements.copyPointsButton.addEventListener('click', PointsCalculator.copyToClipboard);
                DOMElements.resetPointsCalculatorButton.addEventListener('click', PointsCalculator.loadPreset);
            },
            buildDistributionUI: () => {
                let html = '';
                CONFIG.ATTRIBUTES_IDS.forEach(attrId => {
                    html += `
                            <div class="grid grid-cols-12 gap-x-2 sm:gap-x-3 items-center">
                                <label class="col-span-5 sm:col-span-4 font-semibold text-slate-200 text-sm sm:text-base truncate" data-i18n-key="${attrId}">${t(attrId)}</label>
                                <span id="points-for-${attrId}" class="col-span-3 sm:col-span-4 text-green-400 font-bold text-sm sm:text-base text-right">0</span>
                                <div class="col-span-4 sm:col-span-4 flex items-center">
                                    <input type="number" id="percent-for-${attrId}" data-attr="${attrId}" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-1.5 text-center" min="0" max="100">
                                    <span class="ml-2">%</span>
                                </div>
                            </div>
                        `;
                });
                html += `<div class="grid grid-cols-12 gap-2 items-center pt-2 border-t border-gray-600">
                               <label class="col-span-7 font-bold text-slate-200" data-i18n-key="totalPercent">${t('totalPercent')}</label>
                               <span id="total-percent" class="col-span-5 font-bold text-center">100%</span>
                             </div>`;
                DOMElements.pointsDistributionSection.innerHTML = html;
            },
            updateDistribution: () => {
                const totalPoints = Utils.getInputValueAsInt(DOMElements.totalPoints) || 0;
                let totalPercent = 0;
                document.querySelectorAll('#pointsDistributionSection input').forEach(input => {
                    const attrId = input.dataset.attr;
                    const percent = parseFloat(input.value) / 100 || 0;
                    totalPercent += percent;
                    const points = Math.round(totalPoints * percent);
                    document.getElementById(`points-for-${attrId}`).textContent = points.toLocaleString(currentLang);
                });
                const totalPercentEl = document.getElementById('total-percent');
                totalPercentEl.textContent = `${(totalPercent * 100).toFixed(0)}%`;
                totalPercentEl.classList.toggle('text-red-500', Math.round(totalPercent * 100) !== 100);
                totalPercentEl.classList.toggle('text-green-600', Math.round(totalPercent * 100) === 100);
                DOMElements.pointsErrorMessage.textContent = Math.round(totalPercent * 100) !== 100 ? t('errorPercentSum') : '';
            },
            loadPreset: () => {
                const selectedClass = DOMElements.playerClass.value;
                const preset = CLASS_DISTRIBUTIONS[selectedClass];
                for (const attrId in preset) {
                    const input = document.getElementById(`percent-for-${attrId}`);
                    if (input) input.value = (preset[attrId] * 100).toFixed(0);
                }
                PointsCalculator.updateDistribution();
            },
            copyToClipboard: () => {
                let textToCopy = `${t('buildWith')} ${DOMElements.totalPoints.value} ${t('points')}:\n`;
                document.querySelectorAll('#pointsDistributionSection input').forEach(input => {
                    const attrId = input.dataset.attr;
                    const points = document.getElementById(`points-for-${attrId}`).textContent;
                    const percent = input.value;
                    textToCopy += `${t(attrId)}: ${points} ${t('points')} (${percent}%)\n`;
                });
                navigator.clipboard.writeText(textToCopy).then(() => {
                    DOMElements.copyPointsButton.textContent = t('copied');
                    setTimeout(() => { DOMElements.copyPointsButton.textContent = t('copyBuild'); }, 2000);
                });
            }
        };

        function main() {
            currentLang = getLang();
            document.documentElement.lang = currentLang;

            translatePage();

            DOMElements.tabs.forEach(tab => tab.addEventListener('click', () => showTab(tab.dataset.tabId)));

            const savedTotalPoints = localStorage.getItem('totalPoints');
            if (savedTotalPoints) {
                DOMElements.totalPoints.value = savedTotalPoints;
            }

            TimeCalculator.populateDropdowns();
            TimeCalculator.reset();

            DOMElements.calculateTimeButton.addEventListener('click', TimeCalculator.calculateRealTime);
            DOMElements.resetTimeCalculatorButton.addEventListener('click', TimeCalculator.reset);
            DOMElements.roundStartDate.addEventListener('change', () => {
                localStorage.setItem('roundStartDate', DOMElements.roundStartDate.value);
                TimeCalculator.calculateCurrentGameTime();
                TimeCalculator.calculateCurrentRoundEndDate();
            });
            DOMElements.targetDay.addEventListener('change', () => localStorage.setItem('targetDay', DOMElements.targetDay.value));
            DOMElements.targetHour.addEventListener('change', () => localStorage.setItem('targetHour', DOMElements.targetHour.value));
            DOMElements.targetMinute.addEventListener('change', () => localStorage.setItem('targetMinute', DOMElements.targetMinute.value));

            PointsCalculator.init();

            showTab('timeCalculatorTabContent');

            setInterval(() => {
                if (!document.getElementById('timeCalculatorTabContent').classList.contains('hidden')) {
                    TimeCalculator.calculateCurrentGameTime();
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', main);
    </script>
</body>
</html>