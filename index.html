<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora The Crims | Refinada</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">

    <style>
        /* Estilos base e para componentes que são difíceis de estilizar com utilitários puros */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Esconde as setas de inputs do tipo 'number' */
        input[type="number"]::-webkit-outer-spin-button,
        input[type="number"]::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"] {
            -moz-appearance: textfield;
        }
        /* Estilo para a aba ativa */
        .tab-button.active {
            border-color: #f59e0b; /* amber-500 */
            background-color: #f59e0b;
            color: white;
        }
    </style>
</head>
<body class="bg-gray-900 text-slate-300 flex items-center justify-center min-h-screen p-4">

    <div class="container bg-gray-800 p-6 sm:p-8 rounded-2xl shadow-2xl max-w-2xl w-full mx-auto space-y-6">
        <header class="text-center">
            <h1 class="text-3xl sm:text-4xl font-extrabold text-amber-400">Calculadora The Crims</h1>
            <p class="text-slate-400 mt-1">Ferramentas para otimizar seu jogo.</p>
        </header>

        <nav class="flex border-b border-gray-700">
            <button class="tab-button flex-1 py-3 px-4 text-sm sm:text-base font-semibold text-slate-400 border-b-2 border-transparent transition-colors duration-300 hover:text-amber-400" data-tab-id="timeCalculatorTabContent">
                Calculadora de Tempo
            </button>
            <button class="tab-button flex-1 py-3 px-4 text-sm sm:text-base font-semibold text-slate-400 border-b-2 border-transparent transition-colors duration-300 hover:text-amber-400" data-tab-id="pointsCalculatorTabContent">
                Calculadora de Pontos
            </button>
        </nav>

        <main>
            <div id="timeCalculatorTabContent" class="tab-content space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="input-group space-y-2">
                        <label for="roundStartDate" class="font-semibold text-slate-200">Início da Rodada (Real):</label>
                        <input type="datetime-local" id="roundStartDate" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-slate-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                    </div>
                    <div class="input-group space-y-2">
                        <label for="currentRoundEndDate" class="font-semibold text-slate-200">Fim da Rodada (Real):</label>
                        <input type="datetime-local" id="currentRoundEndDate" readonly class="w-full bg-gray-900 border border-gray-700 rounded-lg p-2.5 text-slate-400 cursor-not-allowed">
                    </div>
                </section>

                <section>
                    <h3 class="font-bold text-lg text-slate-200 mb-2">Tempo Atual no Jogo</h3>
                    <div class="grid grid-cols-3 gap-3 text-center bg-gray-900/50 p-4 rounded-lg">
                        <div>
                            <span class="text-xs text-slate-400">Dia</span>
                            <input type="number" id="currentDay" readonly class="w-full bg-transparent text-amber-400 text-2xl font-bold text-center outline-none">
                        </div>
                        <div>
                            <span class="text-xs text-slate-400">Hora</span>
                            <input type="number" id="currentHour" readonly class="w-full bg-transparent text-amber-400 text-2xl font-bold text-center outline-none">
                        </div>
                        <div>
                            <span class="text-xs text-slate-400">Minuto</span>
                            <input type="number" id="currentMinute" readonly class="w-full bg-transparent text-amber-400 text-2xl font-bold text-center outline-none">
                        </div>
                    </div>
                </section>

                <section>
                    <h3 class="font-bold text-lg text-slate-200 mb-2">Tempo Desejado no Jogo</h3>
                    <div class="grid grid-cols-3 gap-3">
                        <input type="number" id="targetDay" placeholder="Dia" min="1" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-center focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                        <input type="number" id="targetHour" placeholder="Hora" min="0" max="23" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-center focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                        <input type="number" id="targetMinute" placeholder="Minuto" min="0" max="59" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-center focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                    </div>
                </section>

                <div class="button-group flex flex-col sm:flex-row gap-3 pt-4">
                    <button id="calculateTimeButton" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">Calcular</button>
                    <button id="resetTimeCalculatorButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">Redefinir</button>
                </div>

                <div id="result" class="text-center font-semibold text-green-400 min-h-[1.5em]"></div>
                <div id="localTimeResult" class="text-center text-sm text-slate-400 min-h-[1.25em]"></div>
                <div id="errorMessage" class="text-center font-semibold text-red-500 min-h-[1.5em]"></div>
            </div>

            <div id="pointsCalculatorTabContent" class="tab-content hidden space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="input-group space-y-2">
                        <label for="totalPoints" class="font-semibold text-slate-200">Total de Pontos:</label>
                        <input type="number" id="totalPoints" min="0" value="10000" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-slate-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                    </div>
                    <div class="input-group space-y-2">
                        <label for="playerClass" class="font-semibold text-slate-200">Sua Classe:</label>
                        <select id="playerClass" class="w-full bg-gray-700 border border-gray-600 rounded-lg p-2.5 text-slate-200 focus:ring-2 focus:ring-amber-500 focus:border-amber-500 outline-none">
                            <option value="assassino">Assassino de Aluguel</option>
                            <option value="cafetao">Cafetão</option>
                            <option value="corretor">Corretor</option>
                            <option value="empresario">Empresário</option>
                            <option value="ladrao">Ladrão</option>
                            <option value="traficante">Traficante</option>
                        </select>
                    </div>
                </section>

                <div class="button-group flex flex-col sm:flex-row gap-3 pt-4">
                    <button id="calculatePointsButton" class="w-full bg-amber-500 hover:bg-amber-600 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">Calcular Distribuição</button>
                    <button id="resetPointsCalculatorButton" class="w-full bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-4 rounded-lg transition-transform transform hover:scale-105">Redefinir</button>
                </div>

                <div id="pointsResult" class="space-y-2"></div>
                <div id="pointsErrorMessage" class="text-center font-semibold text-red-500 min-h-[1.5em]"></div>
            </div>
        </main>
    </div>

    <script type="module">
        // --- CONFIGURAÇÕES GLOBAIS ---
        const CONFIG = {
            REAL_HOURS_PER_GAME_DAY: 6,
            GAME_MINUTES_PER_REAL_MINUTE: (24 / 6),
            DEFAULT_ROUND_START_DATE: new Date(2025, 6, 2, 12, 0), // Mês é 0-indexado (6 = Julho)
            ROUND_DURATION_GAME_DAYS: 52,
            CLASS_DISTRIBUTIONS: {
                assassino: { Força: 0.50, Tolerância: 0.30, Inteligência: 0.15, Carisma: 0.05 },
                cafetao: { Carisma: 0.40, Inteligência: 0.25, Tolerância: 0.25, Força: 0.10 },
                corretor: { Inteligência: 0.45, Carisma: 0.35, Tolerância: 0.15, Força: 0.05 },
                empresario: { Inteligência: 0.45, Carisma: 0.35, Tolerância: 0.15, Força: 0.05 },
                ladrao: { Inteligência: 0.40, Tolerância: 0.35, Força: 0.20, Carisma: 0.05 },
                traficante: { Inteligência: 0.38, Tolerância: 0.28, Carisma: 0.28, Força: 0.06 }
            }
        };

        // --- SELETORES DE ELEMENTOS DOM ---
        const DOMElements = {
            tabs: document.querySelectorAll('.tab-button'),
            tabContents: document.querySelectorAll('.tab-content'),

            // Calculadora de Tempo
            roundStartDate: document.getElementById('roundStartDate'),
            currentRoundEndDate: document.getElementById('currentRoundEndDate'),
            currentDay: document.getElementById('currentDay'),
            currentHour: document.getElementById('currentHour'),
            currentMinute: document.getElementById('currentMinute'),
            targetDay: document.getElementById('targetDay'),
            targetHour: document.getElementById('targetHour'),
            targetMinute: document.getElementById('targetMinute'),
            calculateTimeButton: document.getElementById('calculateTimeButton'),
            resetTimeCalculatorButton: document.getElementById('resetTimeCalculatorButton'),
            result: document.getElementById('result'),
            localTimeResult: document.getElementById('localTimeResult'),
            errorMessage: document.getElementById('errorMessage'),

            // Calculadora de Pontos
            totalPoints: document.getElementById('totalPoints'),
            playerClass: document.getElementById('playerClass'),
            calculatePointsButton: document.getElementById('calculatePointsButton'),
            resetPointsCalculatorButton: document.getElementById('resetPointsCalculatorButton'),
            pointsResult: document.getElementById('pointsResult'),
            pointsErrorMessage: document.getElementById('pointsErrorMessage')
        };

        // --- FUNÇÕES UTILITÁRIAS ---
        const Utils = {
            formatDateForInput: (date) => {
                const pad = (num) => String(num).padStart(2, '0');
                return `${date.getFullYear()}-${pad(date.getMonth() + 1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
            },
            clearMessages: (...elements) => {
                elements.forEach(el => { if (el) el.textContent = ''; });
            },
            getInputValueAsInt: (element) => parseInt(element.value, 10),
            setInputValue: (element, value) => { element.value = value; }
        };

        // --- LÓGICA DAS ABAS ---
        function showTab(tabId) {
            DOMElements.tabContents.forEach(content => content.classList.add('hidden'));
            DOMElements.tabs.forEach(tab => tab.classList.remove('active'));

            document.getElementById(tabId).classList.remove('hidden');
            document.querySelector(`.tab-button[data-tab-id="${tabId}"]`).classList.add('active');
            Utils.clearMessages(DOMElements.errorMessage, DOMElements.result, DOMElements.localTimeResult, DOMElements.pointsErrorMessage, DOMElements.pointsResult);
        }

        // --- LÓGICA DA CALCULADORA DE TEMPO ---
        const TimeCalculator = {
            calculateCurrentGameTime: () => {
                if (!DOMElements.roundStartDate.value) return false;
                const roundStart = new Date(DOMElements.roundStartDate.value);
                const now = new Date();
                const diffMs = now.getTime() - roundStart.getTime();

                if (diffMs < 0) {
                    [DOMElements.currentDay.value, DOMElements.currentHour.value, DOMElements.currentMinute.value] = [1, 0, 0];
                    return false;
                }

                const diffGameMinutes = (diffMs / 60000) * CONFIG.GAME_MINUTES_PER_REAL_MINUTE;
                const gameDays = Math.floor(diffGameMinutes / 1440);
                const remainingMinutes = diffGameMinutes % 1440;
                const gameHours = Math.floor(remainingMinutes / 60);
                const gameMinutes = Math.floor(remainingMinutes % 60);

                Utils.setInputValue(DOMElements.currentDay, gameDays + 1);
                Utils.setInputValue(DOMElements.currentHour, gameHours);
                Utils.setInputValue(DOMElements.currentMinute, gameMinutes);
                return true;
            },
            calculateCurrentRoundEndDate: () => {
                if (!DOMElements.roundStartDate.value) {
                    Utils.setInputValue(DOMElements.currentRoundEndDate, '');
                    return;
                }
                const roundStart = new Date(DOMElements.roundStartDate.value);
                const endDateMs = roundStart.getTime() + (CONFIG.ROUND_DURATION_GAME_DAYS * CONFIG.REAL_HOURS_PER_GAME_DAY * 3600000);
                Utils.setInputValue(DOMElements.currentRoundEndDate, Utils.formatDateForInput(new Date(endDateMs)));
            },
            calculateRealTime: () => {
                Utils.clearMessages(DOMElements.result, DOMElements.localTimeResult, DOMElements.errorMessage);
                if (!TimeCalculator.calculateCurrentGameTime()) {
                    DOMElements.errorMessage.textContent = 'Insira uma Data/Hora de Início da Rodada válida e no passado.';
                    return;
                }
                const [currentDay, currentHour, currentMinute] = [DOMElements.currentDay, DOMElements.currentHour, DOMElements.currentMinute].map(Utils.getInputValueAsInt);
                const [targetDay, targetHour, targetMinute] = [DOMElements.targetDay, DOMElements.targetHour, DOMElements.targetMinute].map(Utils.getInputValueAsInt);

                if ([targetDay, targetHour, targetMinute].some(isNaN)) {
                    DOMElements.errorMessage.textContent = 'Preencha todos os campos de "Tempo Desejado".';
                    return;
                }

                const currentTotalMinutes = (currentDay * 1440) + (currentHour * 60) + currentMinute;
                const targetTotalMinutes = (targetDay * 1440) + (targetHour * 60) + targetMinute;

                if (targetTotalMinutes < currentTotalMinutes) {
                    DOMElements.errorMessage.textContent = 'O tempo desejado deve ser no futuro.';
                    return;
                }

                const diffGameMinutes = targetTotalMinutes - currentTotalMinutes;
                const diffRealSeconds = diffGameMinutes * (60 / CONFIG.GAME_MINUTES_PER_REAL_MINUTE);

                if (diffRealSeconds === 0) {
                    DOMElements.result.textContent = 'O tempo atual e o desejado são os mesmos.';
                    return;
                }

                const hours = Math.floor(diffRealSeconds / 3600);
                const minutes = Math.floor((diffRealSeconds % 3600) / 60);
                const resultParts = [];
                if (hours > 0) resultParts.push(`${hours} hora${hours > 1 ? 's' : ''}`);
                if (minutes > 0) resultParts.push(`${minutes} minuto${minutes > 1 ? 's' : ''}`);
                DOMElements.result.textContent = `Tempo real necessário: ${resultParts.join(' e ')}`;

                const targetRealDate = new Date(new Date().getTime() + diffRealSeconds * 1000);
                DOMElements.localTimeResult.textContent = `Hora local prevista: ${targetRealDate.toLocaleString('pt-BR', { dateStyle: 'long', timeStyle: 'medium' })}`;
            },
            reset: () => {
                Utils.setInputValue(DOMElements.roundStartDate, Utils.formatDateForInput(CONFIG.DEFAULT_ROUND_START_DATE));
                TimeCalculator.calculateCurrentRoundEndDate();
                TimeCalculator.calculateCurrentGameTime();
                Utils.setInputValue(DOMElements.targetDay, DOMElements.currentDay.value);
                Utils.setInputValue(DOMElements.targetHour, DOMElements.currentHour.value);
                Utils.setInputValue(DOMElements.targetMinute, DOMElements.currentMinute.value);
                Utils.clearMessages(DOMElements.result, DOMElements.localTimeResult, DOMElements.errorMessage);
            }
        };

        // --- LÓGICA DA CALCULADORA DE PONTOS ---
        const PointsCalculator = {
            calculate: () => {
                Utils.clearMessages(DOMElements.pointsResult, DOMElements.pointsErrorMessage);
                const totalPoints = Utils.getInputValueAsInt(DOMElements.totalPoints);
                if (isNaN(totalPoints) || totalPoints < 0) {
                    DOMElements.pointsErrorMessage.textContent = 'Insira um total de pontos válido.';
                    return;
                }
                const percentages = CONFIG.CLASS_DISTRIBUTIONS[DOMElements.playerClass.value];
                const className = DOMElements.playerClass.options[DOMElements.playerClass.selectedIndex].text;

                let resultHtml = `<h3 class="font-bold text-lg text-slate-200 mb-2">Distribuição para ${className}:</h3>`;
                resultHtml += '<div class="bg-gray-900/50 p-4 rounded-lg space-y-2">';

                for (const attribute in percentages) {
                    const points = Math.round(totalPoints * percentages[attribute]);
                    resultHtml += `
                            <div class="flex justify-between items-center text-sm">
                                <span class="font-semibold text-slate-300">${attribute}:</span>
                                <span class="font-bold text-green-400">${points.toLocaleString('pt-BR')} <span class="text-xs text-slate-400 font-normal">(${(percentages[attribute] * 100).toFixed(0)}%)</span></span>
                            </div>`;
                }
                resultHtml += '</div>';
                DOMElements.pointsResult.innerHTML = resultHtml;
            },
            reset: () => {
                Utils.setInputValue(DOMElements.totalPoints, 10000);
                Utils.setInputValue(DOMElements.playerClass, 'assassino');
                Utils.clearMessages(DOMElements.pointsResult, DOMElements.pointsErrorMessage);
            }
        };

        // --- INICIALIZAÇÃO E EVENTOS ---
        function init() {
            // Abas
            DOMElements.tabs.forEach(tab => tab.addEventListener('click', () => showTab(tab.dataset.tabId)));

            // Calculadora de Tempo
            DOMElements.calculateTimeButton.addEventListener('click', TimeCalculator.calculateRealTime);
            DOMElements.resetTimeCalculatorButton.addEventListener('click', TimeCalculator.reset);
            DOMElements.roundStartDate.addEventListener('change', () => {
                TimeCalculator.calculateCurrentGameTime();
                TimeCalculator.calculateCurrentRoundEndDate();
            });

            // Calculadora de Pontos
            DOMElements.calculatePointsButton.addEventListener('click', PointsCalculator.calculate);
            DOMElements.resetPointsCalculatorButton.addEventListener('click', PointsCalculator.reset);

            // Estado Inicial
            showTab('timeCalculatorTabContent');
            TimeCalculator.reset();
            PointsCalculator.reset();

            // Loop de atualização do relógio em tempo real (otimizado)
            setInterval(() => {
                if (document.getElementById('timeCalculatorTabContent').classList.contains('hidden') === false) {
                    TimeCalculator.calculateCurrentGameTime();
                }
            }, 1000);
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>